{% extends "base.html" %}
{% from "macros.html" import lesson_card %}

{% block title %}{{ course.title }} - VietEnglish{% endblock %}

{% block extra_css %}
<style>
    .course-header {
        background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                    url('{{ url_for('static', filename='uploads/' + course.image) }}');
        background-size: cover;
        background-position: center;
        color: white;
        padding: 80px 0;
        margin-bottom: 40px;
        position: relative;
    }
    
    .course-meta {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        backdrop-filter: blur(5px);
    }
    
    .course-meta .item {
        border-right: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .course-meta .item:last-child {
        border-right: none;
    }
    
    .course-content-card {
        position: relative;
        top: -60px;
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: -40px;
    }
    
    .nav-pills .nav-link {
        color: #555;
        font-weight: 500;
        padding: 12px 20px;
        border-radius: 0;
        transition: all 0.3s;
    }
    
    .nav-pills .nav-link.active {
        background-color: transparent;
        color: var(--primary-color);
        border-bottom: 2px solid var(--primary-color);
    }
    
    .nav-pills .nav-link:hover:not(.active) {
        background-color: rgba(67, 97, 238, 0.05);
    }
    
    .course-info-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-right: 15px;
    }
    
    .course-info-icon.level {
        background-color: rgba(76, 201, 240, 0.1);
        color: #4cc9f0;
    }
    
    .course-info-icon.duration {
        background-color: rgba(67, 97, 238, 0.1);
        color: #4361ee;
    }
    
    .course-info-icon.lessons {
        background-color: rgba(247, 37, 133, 0.1);
        color: #f72585;
    }
    
    .course-info-icon.students {
        background-color: rgba(58, 12, 163, 0.1);
        color: #3a0ca3;
    }
    
    .enrollment-card {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 100px;
    }
    
    .enrollment-header {
        background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 20px;
    }
    
    .teacher-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid white;
    }
    
    .lesson-list-container {
        max-height: 400px;
        overflow-y: auto;
        padding-right: 10px;
    }
    
    /* Custom scrollbar */
    .lesson-list-container::-webkit-scrollbar {
        width: 6px;
    }
    
    .lesson-list-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .lesson-list-container::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 10px;
    }
    
    .lesson-list-container::-webkit-scrollbar-thumb:hover {
        background: #aaa;
    }
</style>
{% endblock %}

{% block content %}
<!-- Course Header -->
<section class="course-header">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <span class="badge bg-primary mb-2">{{ course.level }}</span>
                <h1 class="display-5 fw-bold mb-3">{{ course.title }}</h1>
                
                <div class="d-flex align-items-center mb-4">
                    <img src="{{ url_for('static', filename='uploads/' + course.creator.avatar) }}" 
                        alt="{{ course.creator.username }}" class="teacher-avatar me-3">
                    <div>
                        <p class="mb-0">Giáo viên</p>
                        <h5 class="mb-0">{{ course.creator.fullname if course.creator.fullname else course.creator.username }}</h5>
                    </div>
                </div>
                
                <div class="row course-meta">
                    <div class="col-md-3 col-6 item text-center">
                        <p class="mb-1"><i class="fas fa-layer-group me-2"></i>Trình độ</p>
                        <h6 class="mb-0">{{ course.level }}</h6>
                    </div>
                    <div class="col-md-3 col-6 item text-center">
                        <p class="mb-1"><i class="fas fa-calendar-alt me-2"></i>Thời lượng</p>
                        <h6 class="mb-0">{{ course.duration_weeks }} tuần</h6>
                    </div>
                    <div class="col-md-3 col-6 item text-center">
                        <p class="mb-1"><i class="fas fa-book-open me-2"></i>Bài học</p>
                        <h6 class="mb-0">{{ lessons|length }}</h6>
                    </div>
                    <div class="col-md-3 col-6 item text-center">
                        <p class="mb-1"><i class="fas fa-users me-2"></i>Học viên</p>
                        <h6 class="mb-0">{{ course.enrollments|length }}</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="container">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <div class="card course-content-card mb-4">
                <!-- Course Navigation Tabs -->
                <div class="card-header bg-white p-0">
                    <ul class="nav nav-pills nav-fill" id="courseTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" 
                                    data-bs-target="#overview" type="button" role="tab" 
                                    aria-controls="overview" aria-selected="true">
                                <i class="fas fa-info-circle me-2"></i>Tổng quan
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="lessons-tab" data-bs-toggle="tab" 
                                    data-bs-target="#lessons" type="button" role="tab" 
                                    aria-controls="lessons" aria-selected="false">
                                <i class="fas fa-book me-2"></i>Bài học
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" 
                                    data-bs-target="#reviews" type="button" role="tab" 
                                    aria-controls="reviews" aria-selected="false">
                                <i class="fas fa-star me-2"></i>Đánh giá
                            </button>
                        </li>
                    </ul>
                </div>
                
                <!-- Tab Content -->
                <div class="card-body">
                    <div class="tab-content" id="courseTabContent">
                        <!-- Overview Tab -->
                        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                            <h4 class="mb-4">Giới thiệu khóa học</h4>
                            <p>{{ course.description }}</p>
                            
                            <div class="row mt-5">
                                <div class="col-md-6 mb-4">
                                    <div class="d-flex">
                                        <div class="course-info-icon level">
                                            <i class="fas fa-layer-group"></i>
                                        </div>
                                        <div>
                                            <h5>Trình độ</h5>
                                            <p>{{ course.level }}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-4">
                                    <div class="d-flex">
                                        <div class="course-info-icon duration">
                                            <i class="fas fa-calendar-alt"></i>
                                        </div>
                                        <div>
                                            <h5>Thời lượng</h5>
                                            <p>{{ course.duration_weeks }} tuần</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-4">
                                    <div class="d-flex">
                                        <div class="course-info-icon lessons">
                                            <i class="fas fa-book-open"></i>
                                        </div>
                                        <div>
                                            <h5>Số bài học</h5>
                                            <p>{{ lessons|length }} bài học</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-4">
                                    <div class="d-flex">
                                        <div class="course-info-icon students">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div>
                                            <h5>Học viên</h5>
                                            <p>{{ course.enrollments|length }} học viên đã đăng ký</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-5">
                                <h4 class="mb-4">Bạn sẽ học được gì?</h4>
                                <div class="row">
                                    <div class="col-md-6">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item border-0 ps-0">
                                                <i class="fas fa-check-circle text-success me-2"></i>Nắm vững các cấu trúc ngữ pháp cơ bản
                                            </li>
                                            <li class="list-group-item border-0 ps-0">
                                                <i class="fas fa-check-circle text-success me-2"></i>Phát triển vốn từ vựng theo chủ đề
                                            </li>
                                            <li class="list-group-item border-0 ps-0">
                                                <i class="fas fa-check-circle text-success me-2"></i>Cải thiện kỹ năng nghe và nói
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item border-0 ps-0">
                                                <i class="fas fa-check-circle text-success me-2"></i>Tự tin giao tiếp trong các tình huống thực tế
                                            </li>
                                            <li class="list-group-item border-0 ps-0">
                                                <i class="fas fa-check-circle text-success me-2"></i>Nâng cao kỹ năng đọc hiểu
                                            </li>
                                            <li class="list-group-item border-0 ps-0">
                                                <i class="fas fa-check-circle text-success me-2"></i>Phát triển khả năng viết đa dạng thể loại
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-5">
                                <h4 class="mb-4">Đối tượng học viên</h4>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item border-0 ps-0">
                                        <i class="fas fa-user-check text-primary me-2"></i>Người học có trình độ {{ course.level }}
                                    </li>
                                    <li class="list-group-item border-0 ps-0">
                                        <i class="fas fa-user-check text-primary me-2"></i>Người học muốn nâng cao kỹ năng tiếng Anh trong chủ đề {{ course.topic }}
                                    </li>
                                    <li class="list-group-item border-0 ps-0">
                                        <i class="fas fa-user-check text-primary me-2"></i>Người học muốn phát triển kỹ năng giao tiếp thực tế
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Lessons Tab -->
                        <div class="tab-pane fade" id="lessons" role="tabpanel" aria-labelledby="lessons-tab">
                            <h4 class="mb-4">Nội dung khóa học</h4>
                            
                            <div class="lesson-list-container">
                                {% if lessons %}
                                    {% for lesson in lessons|sort(attribute='order') %}
                                        {{ lesson_card(lesson, course) }}
                                    {% endfor %}
                                {% else %}
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>Khóa học này chưa có bài học nào.
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Reviews Tab -->
                        <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="mb-0">Đánh giá từ học viên</h4>
                                <span class="badge bg-primary p-2">
                                    <i class="fas fa-star text-warning me-1"></i> 4.5/5 ({{ course.enrollments|length }} đánh giá)
                                </span>
                            </div>
                            
                            <div class="mb-4">
                                <div class="progress mb-3" style="height: 10px;">
                                    <div class="progress-bar bg-success" style="width: 75%;" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">5 ★ (75%)</div>
                                </div>
                                <div class="progress mb-3" style="height: 10px;">
                                    <div class="progress-bar bg-success" style="width: 15%;" role="progressbar" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100">4 ★ (15%)</div>
                                </div>
                                <div class="progress mb-3" style="height: 10px;">
                                    <div class="progress-bar bg-warning" style="width: 7%;" role="progressbar" aria-valuenow="7" aria-valuemin="0" aria-valuemax="100">3 ★ (7%)</div>
                                </div>
                                <div class="progress mb-3" style="height: 10px;">
                                    <div class="progress-bar bg-danger" style="width: 2%;" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100">2 ★ (2%)</div>
                                </div>
                                <div class="progress mb-3" style="height: 10px;">
                                    <div class="progress-bar bg-danger" style="width: 1%;" role="progressbar" aria-valuenow="1" aria-valuemin="0" aria-valuemax="100">1 ★ (1%)</div>
                                </div>
                            </div>
                            
                            <!-- Sample Reviews -->
                            <div class="card mb-3 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex mb-3">
                                        <img src="{{ url_for('static', filename='uploads/default_avatar.png') }}" 
                                            alt="Avatar" class="avatar me-3" style="width: 50px; height: 50px;">
                                        <div>
                                            <h6 class="mb-0">Nguyễn Văn A</h6>
                                            <div class="text-warning">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                            </div>
                                            <small class="text-muted">2 tháng trước</small>
                                        </div>
                                    </div>
                                    <p>Khóa học rất hay và bổ ích. Tôi đã học được rất nhiều từ vựng và ngữ pháp mới. Giáo viên giảng dạy rõ ràng và dễ hiểu. Tôi sẽ tiếp tục học các khóa học khác.</p>
                                </div>
                            </div>
                            
                            <div class="card mb-3 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex mb-3">
                                        <img src="{{ url_for('static', filename='uploads/default_avatar.png') }}" 
                                            alt="Avatar" class="avatar me-3" style="width: 50px; height: 50px;">
                                        <div>
                                            <h6 class="mb-0">Trần Thị B</h6>
                                            <div class="text-warning">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="far fa-star"></i>
                                            </div>
                                            <small class="text-muted">1 tháng trước</small>
                                        </div>
                                    </div>
                                    <p>Khóa học có nhiều bài tập thực hành giúp tôi cải thiện kỹ năng nói và nghe rất nhiều. Tuy nhiên, phần ngữ pháp có thể chi tiết hơn một chút. Nhìn chung, tôi hài lòng với khóa học này.</p>
                                </div>
                            </div>
                            
                            <div class="card mb-3 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex mb-3">
                                        <img src="{{ url_for('static', filename='uploads/default_avatar.png') }}" 
                                            alt="Avatar" class="avatar me-3" style="width: 50px; height: 50px;">
                                        <div>
                                            <h6 class="mb-0">Lê Văn C</h6>
                                            <div class="text-warning">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star-half-alt"></i>
                                            </div>
                                            <small class="text-muted">2 tuần trước</small>
                                        </div>
                                    </div>
                                    <p>Trợ lý AI rất hữu ích trong việc giải đáp thắc mắc của tôi. Nội dung khóa học được thiết kế hợp lý và phù hợp với trình độ của tôi. Tôi đã đạt được nhiều tiến bộ sau khi hoàn thành khóa học.</p>
                                </div>
                            </div>
                            
                            {% if enrollment %}
                                <div class="mt-4">
                                    <h5>Viết đánh giá của bạn</h5>
                                    <form>
                                        <div class="mb-3">
                                            <label class="form-label">Đánh giá của bạn</label>
                                            <div class="rating-stars fs-3 mb-2">
                                                <i class="far fa-star text-warning rating-star" data-rating="1"></i>
                                                <i class="far fa-star text-warning rating-star" data-rating="2"></i>
                                                <i class="far fa-star text-warning rating-star" data-rating="3"></i>
                                                <i class="far fa-star text-warning rating-star" data-rating="4"></i>
                                                <i class="far fa-star text-warning rating-star" data-rating="5"></i>
                                                <input type="hidden" name="rating" id="ratingInput" value="0">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="reviewComment" class="form-label">Nhận xét của bạn</label>
                                            <textarea class="form-control" id="reviewComment" name="comment" rows="4" placeholder="Chia sẻ trải nghiệm của bạn về khóa học này..."></textarea>
                                        </div>
                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-primary">Gửi đánh giá</button>
                                        </div>
                                    </form>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="enrollment-card">
                {% if enrollment %}
                    <div class="enrollment-header">
                        <h4 class="mb-2">Tiến độ khóa học</h4>
                        <p class="mb-0">Bạn đã hoàn thành {{ enrollment.progress|round|int }}% khóa học này</p>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <span>Tiến độ</span>
                                <span>{{ enrollment.progress|round|int }}%</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: {{ enrollment.progress }}%" 
                                    aria-valuenow="{{ enrollment.progress|round|int }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between mb-3">
                            <div class="text-center">
                                <h5>{{ lessons|length }}</h5>
                                <small class="text-muted">Tổng số bài</small>
                            </div>
                            <div class="text-center">
                                <h5>{{ (enrollment.progress / 100 * lessons|length)|round|int }}</h5>
                                <small class="text-muted">Đã hoàn thành</small>
                            </div>
                            <div class="text-center">
                                <h5>{{ lessons|length - (enrollment.progress / 100 * lessons|length)|round|int }}</h5>
                                <small class="text-muted">Còn lại</small>
                            </div>
                        </div>
                        
                        {% if enrollment.progress > 0 %}
                            <a href="{{ url_for('lesson_detail', lesson_id=lessons[0].id) }}" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-play-circle me-2"></i>Tiếp tục học
                            </a>
                        {% else %}
                            <a href="{{ url_for('lesson_detail', lesson_id=lessons[0].id) }}" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-play-circle me-2"></i>Bắt đầu học
                            </a>
                        {% endif %}
                        
                        <div class="alert alert-info mt-3 mb-0">
                            <p class="mb-0"><i class="fas fa-info-circle me-2"></i>Bạn đã đăng ký khóa học này vào {{ enrollment.enrolled_at.strftime('%d/%m/%Y') }}</p>
                        </div>
                    </div>
                {% else %}
                    <div class="enrollment-header">
                        <h4 class="mb-0">Đăng ký khóa học</h4>
                        <p class="mb-0">Bắt đầu hành trình học tiếng Anh ngay hôm nay</p>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h3 class="mb-0 text-primary">Miễn phí</h3>
                            <p class="text-muted mb-0">Truy cập đầy đủ nội dung khóa học</p>
                        </div>
                        
                        <div class="mb-4">
                            <div class="d-flex align-items-center mb-3">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span>{{ lessons|length }} bài học video</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span>Bài tập tương tác</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span>Trợ lý AI 24/7</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span>Tài liệu học tập</span>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span>Chứng chỉ hoàn thành</span>
                            </div>
                        </div>
                        
                        <a href="{{ url_for('enroll_course', course_id=course.id) }}" class="btn btn-primary btn-lg w-100">
                            <i class="fas fa-graduation-cap me-2"></i>Đăng ký ngay
                        </a>
                    </div>
                {% endif %}
            </div>
            
            <!-- Teacher Info -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-chalkboard-teacher me-2 text-primary"></i>Về giáo viên</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <img src="{{ url_for('static', filename='uploads/' + course.creator.avatar) }}" 
                            alt="{{ course.creator.username }}" class="avatar me-3" style="width: 60px; height: 60px;">
                        <div>
                            <h5 class="mb-1">{{ course.creator.fullname if course.creator.fullname else course.creator.username }}</h5>
                            <p class="mb-0 text-muted">Giáo viên tiếng Anh</p>
                        </div>
                    </div>
                    <p>Giáo viên có kinh nghiệm giảng dạy tiếng Anh cho nhiều trình độ khác nhau. Chuyên môn về ngữ pháp và phát âm, với phương pháp giảng dạy tương tác giúp học viên tiến bộ nhanh chóng.</p>
                    <div class="d-flex justify-content-between">
                        <div class="text-center">
                            <h5>{{ course.creator.created_courses|length }}</h5>
                            <small class="text-muted">Khóa học</small>
                        </div>
                        <div class="text-center">
                            <h5>4.8</h5>
                            <small class="text-muted">Đánh giá</small>
                        </div>
                        <div class="text-center">
                            <h5>1000+</h5>
                            <small class="text-muted">Học viên</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Share -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-share-alt me-2 text-primary"></i>Chia sẻ khóa học</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-center">
                        <a href="#" class="btn btn-outline-primary me-2">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="btn btn-outline-primary me-2">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="btn btn-outline-primary me-2">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="#" class="btn btn-outline-primary">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Rating stars functionality
        const ratingStars = document.querySelectorAll('.rating-star');
        const ratingInput = document.getElementById('ratingInput');
        
        if (ratingStars.length > 0 && ratingInput) {
            ratingStars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    ratingInput.value = rating;
                    
                    // Update stars display
                    ratingStars.forEach((s, index) => {
                        if (index < rating) {
                            s.classList.remove('far');
                            s.classList.add('fas');
                        } else {
                            s.classList.remove('fas');
                            s.classList.add('far');
                        }
                    });
                });
                
                star.addEventListener('mouseover', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    
                    // Update stars display on hover
                    ratingStars.forEach((s, index) => {
                        if (index < rating) {
                            s.classList.remove('far');
                            s.classList.add('fas');
                        } else {
                            s.classList.remove('fas');
                            s.classList.add('far');
                        }
                    });
                });
                
                star.addEventListener('mouseout', function() {
                    const currentRating = parseInt(ratingInput.value);
                    
                    // Reset to current rating on mouseout
                    ratingStars.forEach((s, index) => {
                        if (index < currentRating) {
                            s.classList.remove('far');
                            s.classList.add('fas');
                        } else {
                            s.classList.remove('fas');
                            s.classList.add('far');
                        }
                    });
                });
            });
        }
        
        // Smooth scroll to lessons tab if lesson parameter is present
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('lesson')) {
            document.getElementById('lessons-tab').click();
            
            // Scroll to the specific lesson
            const lessonId = urlParams.get('lesson');
            const lessonElement = document.getElementById('lesson-' + lessonId);
            if (lessonElement) {
                setTimeout(() => {
                    lessonElement.scrollIntoView({ behavior: 'smooth' });
                    lessonElement.classList.add('border-primary');
                    setTimeout(() => {
                        lessonElement.classList.remove('border-primary');
                    }, 2000);
                }, 500);
            }
        }
    });
</script>
{% endblock %}